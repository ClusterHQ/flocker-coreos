#!/opt/flocker/bin/python

# -*- coding: utf-8 -*-
import re
import sys

from flocker.node.script import AgentService, AgentServiceFactory, flocker_dataset_agent_main

DATASET_IP = os.environ.get('FLOCKER_DATASET_IP')

if DATASET_IP is None:
    sys.stderr.write("FLOCKER_DATASET_IP env variable required")
    exit(1)

def get_external_ip_from_env(self, host, port):
    return unicode(DATASET_IP, "ascii")

AgentService.get_external_ip = foo
AgentServiceFactory.get_external_ip = foo

if __name__ == '__main__':
    sys.argv[0] = re.sub(r'(-script\.pyw|\.exe)?$', '', sys.argv[0])
    sys.exit(flocker_dataset_agent_main())